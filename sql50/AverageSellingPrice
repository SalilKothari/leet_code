#Cleaner:

# Write your MySQL query statement below
SELECT 
    p.product_id, 
    IFNULL(ROUND(SUM(p.price * us.units)/SUM(us.units), 2), 0) AS average_price
FROM Prices p
LEFT JOIN UnitsSold us ON p.product_id = us.product_id AND us.purchase_date BETWEEN p.start_date AND p.end_date
GROUP BY product_id;





# Write your MySQL query statement below
WITH intermediate AS 
(
    SELECT 
        p.product_id,
        p.price,
        us.units
    FROM Prices p
    LEFT JOIN UnitsSold us ON p.product_id = us.product_id AND us.purchase_date BETWEEN p.start_date AND p.end_date
)


SELECT product_id, IFNULL(ROUND(SUM(i.price * i.units)/SUM(i.units), 2), 0) AS average_price
FROM intermediate i
GROUP BY product_id;
